{% extends "base.html" %}

{% block title %}注册 - 智慧教育平台{% endblock %}

{% block body %}
<div class="auth-page">
    <div class="auth-left">
        <h1>🚀 开启学习之旅</h1>
        <p>
            注册成为会员<br>
            解锁全部学习功能<br>
            让AI成为你的专属老师！
        </p>
        <div class="auth-decorations">
            <div class="auth-decoration">🎯</div>
            <div class="auth-decoration">💡</div>
            <div class="auth-decoration">🏆</div>
        </div>
    </div>
    
    <div class="auth-right">
        <div class="auth-card">
            <h2>创建账号</h2>
            <p class="subtitle">填写信息，开始智能学习</p>
            
            <form class="auth-form" id="registerForm">
                <div class="input-group">
                    <label for="username">用户名 *</label>
                    <input type="text" class="input" id="username" name="username" placeholder="设置一个用户名" required>
                </div>
                
                <div class="input-group">
                    <label for="password">密码 *</label>
                    <input type="password" class="input" id="password" name="password" placeholder="设置密码（至少6位）" required minlength="6">
                </div>
                
                <div class="input-group">
                    <label for="email">邮箱</label>
                    <input type="email" class="input" id="email" name="email" placeholder="选填，用于找回密码">
                </div>
                
                <div class="input-group">
                    <label for="grade">年级</label>
                    <select class="input" id="grade" name="grade">
                        <option value="">选择年级</option>
                        <option value="小学一年级">小学一年级</option>
                        <option value="小学二年级">小学二年级</option>
                        <option value="小学三年级">小学三年级</option>
                        <option value="小学四年级">小学四年级</option>
                        <option value="小学五年级">小学五年级</option>
                        <option value="小学六年级">小学六年级</option>
                        <option value="初中一年级">初中一年级</option>
                        <option value="初中二年级">初中二年级</option>
                        <option value="初中三年级">初中三年级</option>
                        <option value="高中一年级">高中一年级</option>
                        <option value="高中二年级">高中二年级</option>
                        <option value="高中三年级">高中三年级</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>偏好学科</label>
                    <div class="subject-select" id="subjectSelect">
                        <span class="subject-option" data-value="数学">数学</span>
                        <span class="subject-option" data-value="语文">语文</span>
                        <span class="subject-option" data-value="英语">英语</span>
                        <span class="subject-option" data-value="物理">物理</span>
                        <span class="subject-option" data-value="化学">化学</span>
                        <span class="subject-option" data-value="生物">生物</span>
                    </div>
                    <input type="hidden" id="subjects" name="subjects">
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-user-plus"></i>
                    注册
                </button>
            </form>
            
            <div class="auth-footer">
                已有账号？<a href="/login">立即登录</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 学科选择
const subjectOptions = document.querySelectorAll('.subject-option');
const subjectsInput = document.getElementById('subjects');
let selectedSubjects = [];

subjectOptions.forEach(option => {
    option.addEventListener('click', () => {
        const value = option.dataset.value;
        if (option.classList.contains('active')) {
            option.classList.remove('active');
            selectedSubjects = selectedSubjects.filter(s => s !== value);
        } else {
            option.classList.add('active');
            selectedSubjects.push(value);
        }
        subjectsInput.value = selectedSubjects.join(',');
    });
});

// 表单提交
document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    
    try {
        await api('/api/register', {
            method: 'POST',
            body: formData
        });
        showToast('注册成功！');
        setTimeout(() => window.location.href = '/', 500);
    } catch (error) {
        // 错误已在api函数中处理
    }
});
</script>
{% endblock %}
